/* =================================
   1. Variables & Mixins
   ================================= */

// -- SCSS-only Vars (Internal) --
$transition-speed-fast: 0.05s;
$transition-speed-normal: 0.1s;
$transition-main: background-color $transition-speed-normal ease,
	color $transition-speed-fast ease;

// -- Mixins --

// Single-line text overflow
@mixin text-ellipsis {
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}

// Sidebar tab active state (for :hover, :active, .selected)
@mixin sidebar-item-active {
	background-color: var(--sec);
	color: var(--bg);
	font-weight: 600;
}

@mixin scroll-on-hover($duration: 5s) {
	position: relative;
	overflow: hidden;
	white-space: nowrap;
	display: inline-block;
	vertical-align: middle;

	> span {
		display: inline-block;
		transition: transform $duration linear;
	}

	&:hover > span {
		transform: translateX(calc(-100% + 100%));
	}
}
/* =================================
   2. Theming & Base Styles
   ================================= */

// --- Theming Root ---
:root {
	// These are now themeable from JS!
	--spacing-unit: 1rem;
	--border-rad: 5px;
	--font-primary: "CommitMono Nerd Font Mono";

	// Themes
	// improve theming: needs at least three surface colors
	// and three+ text colors (prim, sec, tert with highlight variants)
	&.tokyo {
		--bg: #140f30de;
		--sbg: #094277;
		--prim: #05c5a2;
		--prim2: #5dc9b5;
		--sec: #ec84b3;
	}
	&.mocha {
		--bg: #1e1e2e;
		--sbg: #16122d;
		--bg1: #212547;
		--bg2: #585b70;
		--prim: #b09fe3;
		--prim2: #bac2de;
		--prim3: #a6adc8;
		--sec: #f3bce6;
	}
	&.siloe {
		--bg: #f9e0e3de;
		--sbg: #fbedeede;
		--prim: #522856;
		--sec: #713d77;
	}
}

// --- Font ---
@font-face {
	font-family: "CommitMono Nerd Font";
	src: url("fonts/CommitMonoNerdFont-Regular.otf") format("opentype");
	font-weight: normal;
	font-style: normal;
}

// --- Base & Resets ---

html {
	height: 100%;
	font-size: 62.5%; // 1rem = 10px
	box-sizing: border-box;
	background-color: var(--bg);
	color: var(--prim);
	font-family: var(--font-primary); // Use the CSS var
	overflow: hidden;
	min-height: 0;
}

*,
*::before,
*::after {
	margin: 0;
	padding: 0;
	box-sizing: inherit; // Better box-sizing reset
	scrollbar-gutter: stable !important;
}

body {
	display: flex;
	flex-direction: column;
	height: 100%;
	padding: var(--spacing-unit); // Use the CSS var
	font-size: 1.6rem; // Default to 16px
	max-width: 100%;
	min-height: 0; // Fix for flex children
	overflow: hidden;
	// Specific, performant transition
	transition: $transition-main;
	overflow-x: hidden;
}

/* =================================
   3. Layout
   ================================= */

header {
	padding: var(--spacing-unit); // Use var
	border-bottom: 1px solid var(--prim);
	border-radius: 0;
	transition: transform $transition-speed-normal ease; // Specific transition

	&:hover {
		transform: scale(1.01);
	}
}

#main {
	display: flex;
	flex: 1; // Take remaining vertical space
	padding-top: var(--spacing-unit); // Use var
	min-height: 0; // Allow content to scroll
	max-width: 100%;
}

#sidebar {
	height: 100%;
	flex: 0 0 20%; // Strict 20%
	min-width: 0;
	overflow-y: auto;
	overflow-x: hidden;

	ul {
		display: flex;
		list-style: none;
		flex-direction: column;
		padding-right: 1rem;
	}
}

#content-area {
	display: flex;
	height: 100%;
	// padding-left: var(--spacing-unit); // Use var
	flex: 0 0 80%; // Strict 80%
	max-width: 80%; // Enforce max width
	flex-direction: column;
	min-height: 0;
	padding-left: 1.5rem;
}

footer {
	display: flex;
	flex-direction: row;
	align-items: center;
	// flex-direction: row-reverse; // This moves items to the right
	justify-content: flex-end;
	// margin-top: var(--spacing-unit); // Use var

	> * {
		font-size: 1rem;
	}
}

/* =================================
   4. Components
   ================================= */

// --- Sidebar Components ---

.tab-separator {
	margin-left: var(--spacing-unit); // Use var
	margin-top: var(--spacing-unit); // Use var
	border-bottom: 3px solid var(--sbg);
	border-radius: 0;
	font-size: 1.2rem;
}

.sidebar-item {
	display: flex; // For vertical alignment
	align-items: center;
	height: 3rem;
	padding-left: var(--spacing-unit); // Use var
	width: 100%;
	border-radius: var(--border-rad);
	@include text-ellipsis;
	transition: $transition-main, transform $transition-speed-normal ease;
	// @include scroll-on-hover(7s);

	&:hover {
		@include sidebar-item-active; // Use mixin
		// border: 1px solid var(--sec);
	}

	&:active {
		@include sidebar-item-active; // Use mixin
		transform: scale(0.95);
	}

	&.selected {
		@include sidebar-item-active; // Use mixin
	}
}

// --- Content Area Components ---

.config-set {
	display: flex;
	height: 100%;
	flex: 0 1 auto;
	flex-direction: column;
	min-height: 0;
	overflow-y: scroll;
	margin-top: 1rem;
	padding-right: 2rem;

	// Nest child selectors for clarity
	h1 {
		margin-bottom: var(--spacing-unit); // Use var
		font-size: 1.6rem;
	}

	// Specific styles for the #settings tab
	&#settings {
		.setting-container {
			display: flex;
			margin-left: var(--spacing-unit); // Use var
			flex-direction: row;
			align-items: center;

			input[type="checkbox"] {
				margin-right: var(--spacing-unit); // Use var
				width: 2rem; // Set a custom width
				height: 2rem; // Set a custom height
				transition: $transition-main;
				&:active {
					transform: scale(1.5);
				}
			}

			label {
				&:hover {
					filter: brightness(5);
				}
			}
		}
	}
}

.config-group {
	position: relative;
	border: 1px solid var(--prim);
	border-radius: var(--border-rad);
	margin-top: var(--spacing-unit);
	margin-bottom: var(--spacing-unit);
	padding: 2rem;
	display: flex;
	flex-direction: column;
}

/* the floating label on the border */
.config-group::before {
	content: attr(data-name);
	position: absolute;
	top: 0;
	left: 1rem; /* adjust for spacing */
	transform: translateY(-50%);
	background-color: var(--bg, #fff); /* match your group background */
	padding: 0 0.5em;
	font-size: 1.6rem;
	color: var(--prim);
	text-transform: capitalize;
}

// --- Editor Item ---
.editor-item {
	position: relative;
}

.editor-item {
	height: auto;
	margin-bottom: var(--spacing-unit); // Use var
	padding: 0.5rem;
	border: 1px solid transparent;
	background-color: var(--sbg);
	opacity: 0.8;
	// background-blend-mode: multiply;
	border-radius: var(--border-rad); // Use var
	font-size: 1.6rem;

	&:focus-within {
		border-color: var(--prim);
		opacity: 1;
	}
	&:focus-visible {
		outline: none;
		border: 1px dashed var(--sec);
	}

	&.compact {
		// background-color: transparent !important;
		> .keybind-editor,
		> .comment-area {
			display: none;
			opacity: 0;
		}
	}

	.editor-item-preview {
		margin-bottom: 2px;
		font-size: 1.4rem;
		i {
			color: var(--sec);
			opacity: 0.7;
		}
	}

	.keybind-editor {
		// grid-template-rows: 1fr;
		// grid-template-columns: repeat(1fr, 4);
		// overflow: hidden;
		display: flex;
		flex-direction: row;
		> * {
			margin-right: var(--spacing-unit); // Use var
			background-color: var(--bg1);
			color: var(--sec);
			flex: 1;
			border-radius: var(--border-rad);
			font-size: 1.6rem !important;
		}
		> textarea {
			padding: 2px 2px;
			border: 0;
			outline: none;
			resize: none;
		}
	}

	.comment-area {
		display: flex;
		align-items: center;
		font-style: italic;
		justify-content: center;
		margin-top: 0.2rem;
		padding: 0;

		> * {
			height: 2rem;
			opacity: (0.6);
			align-items: center;
			justify-content: center;
			&:focus {
				border: none;
				border-bottom: 1px solid var(--sec) !important;
				opacity: 1;
				outline: none;
			}
		}

		&:has(> textarea:placeholder-shown) {
			opacity: 0.6;
		}

		.comment {
			display: flex;
			height: 2rem;
			padding: 2px;
			width: 100%;
			border: 0;
			background-color: transparent;
			color: var(--prim);
			font-style: italic;
			align-items: center;
			resize: none;
			&:hover {
				cursor: text;
				opacity: 1;
			}
		}

		.comment-hashtag {
			padding-top: 0px;
		}
	}
}

// --- Line Comment Item (Specific) ---
.editor-item:has(> .editor-item-comment) {
	margin: 0;
	padding: 0;
	outline: none;
	border: none;
	background-color: transparent;
	opacity: 1;
	// line-height: 0.8;
	// border: 1px solid red;

	> .editor-item-comment {
		margin-bottom: 0;
		width: 100%;
		border: 0;
		background-color: transparent;
		color: var(--prim);
		font-style: italic;
		// line-height: 0.8rem;
		@include text-ellipsis;
		box-shadow: none !important;
		opacity: 0.5;
		outline: none !important;
		resize: none;
		overflow: hidden;

		&::after {
			margin-left: 2px;
			content: " â‡¢";
			flex-shrink: 0;
		}
		&:hover {
			cursor: text;
			opacity: 1;
		}
		&:focus,
		&:focus-visible {
			outline: none;
			border: 1px dashed var(--sec);
		}
	}
}

.todo {
	display: block;
	width: 100%;
	// overflow-x: hidden;
	// overflow-y: auto;
	white-space: normal;
	// word-break: ;
	text-overflow: ellipsis;
	// overflow-x: hidden;
	display: block;
	border-radius: var(--border-rad);
	color: var(--sec);
	// height: 1.6rem;
	width: 100%;
	line-height: 2rem;
	&.disabled {
		text-decoration: line-through;
	}
	> span {
		&#key {
			color: var(--sec);
		}
		&#value {
			color: var(--prim);
		}
	}
}

/* =================================
   5. Base Elements & Utilities
   ================================= */

// --- Base Elements ---
a {
	background: none;
	color: var(--prim);
	text-decoration: none; // Added
	transition: color $transition-speed-normal ease;

	&:hover {
		color: var(--sec); // Added
	}
}

button#theme-toggle {
	border: none;
	background: none;
	cursor: pointer;
	color: var(--prim); // Added
	font-size: 2rem;
	margin-left: 2rem;
	transition: transform $transition-speed-normal ease,
		color $transition-speed-normal ease;

	&:hover {
		transform: scale(1.1);
		color: var(--sec); // Added
	}
}

// --- Utility Classes ---
.blank-line {
	color: transparent;
	max-width: 100%;
}
.hidden {
	display: none !important;
	visibility: hidden;
	flex: 0;
}

.disabled {
	// filter: grayscale(100%);
	// pointer-events: none;
	position: relative;
	opacity: 0.4;
	z-index: auto;
	transform: none; /* ensure no transform creates a context */
}
.disabled::before {
	content: "[x]";
}

.settings-hidden {
	display: none !important;
	visibility: hidden;
	flex: 0;
}

.context-menu {
	position: absolute;
	top: 110%;
	right: 0%;
	display: flex;
	flex-direction: row;
	background-color: var(--bg1);
	z-index: 10 !important;
	border-radius: var(--border-rad);
	padding: calc(var(--spacing-unit) / 2);
	border: 1px solid var(--prim);
	.ctx-button {
		display: flex;
		flex-direction: column;
		width: 4rem;
		align-items: center;
		justify-content: center;
		cursor: pointer;
		overflow: hidden;
		gap: 0.2rem;
		color: var(--sec);
		.ctx-button-icon {
			font-size: 3rem;
			line-height: 2rem;
		}
		.ctx-button-label {
			text-align: center;
			font-size: 1rem;
			line-height: 1rem;
			// @include text-ellipsis();
		}
		&:hover {
			scale: 1.05;
			filter: brightness(1);
		}
		&:active {
			scale: 0.95;
		}
	}
}

// --- Scroll Bars Suck ---

/* width */
::-webkit-scrollbar {
	width: 10px;
	opacity: 0;
	transition: opacity 1s linear;
}
::-webkit-scrollbar:hover {
	width: 10px;
	opacity: 1;
}

/* Track */
::-webkit-scrollbar-track {
	background: transparent;
}

/* Handle */
::-webkit-scrollbar-thumb {
	background: var(--bg1);
	border-radius: var(--border-rad);
	transition: opacity 1s linear;
}

/* Handle on hover */
::-webkit-scrollbar-thumb:hover {
	background: var(--bg2);
}

.scrollable {
	overflow: auto;
	scrollbar-gutter: stable both-edges; /* reserves space inside */
	background-clip: padding-box;
}
